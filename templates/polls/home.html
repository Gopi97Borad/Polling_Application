{% load widget_tweaks %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- Bootstrap -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://mdbcdn.b-cdn.net/wp-content/themes/mdbootstrap4/docs-app/css/dist/mdb5/plugins/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.10.1/mdb.min.css" rel="stylesheet"/>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.10.1/mdb.min.js"></script>
  <!-- Material Design for Bootstrap -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.5.16/css/mdb.min.css" rel="stylesheet">


<style>

.custom-card {
        border: 0; !important;
        box-shadow: 0 10px 15px -3px rgb(0 0 0 / 7%), 0 4px 6px -2px rgb(0 0 0 / 5%);
        /* max-width: 22rem; */
        position: relative;
        display: flex;
        flex-direction: column;
        min-width: 0;
        word-wrap: break-word;
        background-color: #fff;
        background-clip: border-box;
        /* border: 1px solid rgba(0,0,0,.125); */
        border-radius: 0.5rem;
        padding: 0.8rem;
    }
</style>

<script>
    var currentURL = window.location.href
    var xhr = new XMLHttpRequest();

function showDiv(){
  document.getElementById('form').style.display = "block";
  document.getElementById('btn').style.display = "none";
  //document.getElementById('btn1').style.display = "none";
}

function showValue() {
  var name = document.getElementById('name')?.value;
  document.getElementById('form').style.display = "none";
  document.getElementById('btn').style.display = "block";
}

function showValue1() {
  document.getElementById('form').style.display = "none";
  document.getElementById('btn').style.display = "block";
}

function allowDrop(ev) {
  ev.preventDefault();
}

function drag(ev) {
  ev.dataTransfer.setData("text", ev.target.id);
}

function drop(ev) {
  ev.preventDefault();
  var data = ev.dataTransfer.getData('text');
  var target = ev.currentTarget;
  while (" "+target.className+" ".indexOf(" dropzone ") == -1) target = target.parentNode;
  target.appendChild(document.getElementById(data));
  var parentId = target.parentNode.getAttribute("id");
  var category = parentId == "card1" ? 1 : parentId == "card2" ? 2 : 3;
    xhr.open("GET", currentURL + 'update/' + data + '/' + category, true);
    xhr.send();
    window.location.reload();
}

function logout() {
    xhr.open("GET", currentURL + 'logout');
    xhr.send();
    window.reload();
}

function fn_delete(id) {
    xhr.open("GET", currentURL + 'delete/' + id, true);
    xhr.send();
    window.location.reload();
}

window.addEventListener("load",function () {
	var elms = document.querySelectorAll(".div1");
	for (var i = 0; i < elms.length; i++) {
		var zielzone = elms[i];
		zielzone.addEventListener("drop",drop);
		zielzone.addEventListener("dragover",allowDrop);
	};

	elms = document.querySelectorAll("[draggable=true]")
	for (var i = 0; i < elms.length; i++) {
		var draggable = elms[i];
		draggable.addEventListener("dragstart",drag);
	};
});

function editTask(ev) {
     document.getElementById('q-'+ ev).style.display = "block";
     document.getElementById('p-'+ ev).style.display = "none";
}

function hideCard(ev, action, token) {
     document.getElementById('p-'+ ev).style.display = "block";
     document.getElementById('q-'+ ev).style.display = "none";
}
</script>
</head>

{% block main %}

<body>
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-primary">
    <div>
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link font-weight-bold" style="color:#FFFF;font-size: 25px" href="#">Dashboard</a>
            </li>
        </ul>
    </div>
      <form class="ml-auto ">
         <button onclick="logout()" class="btn btn-primary fs-6"><i class="fa fa-power-off me-2"></i>Sign Out</button>
      </form>
</nav>
<!-- Navbar -->

<div class="row mt-3 ms-1 me-1">
    <div  class="col-sm-4">
        <div style="background-color: #e0e0e0" class="card"  id="card1">
            <div class="card-body div1" id="div1">
                <h4 class="card-title"><a class="font-weight-bold" style="font-size: 35px">Doing</a></h4>
               <div class="card-text">
                <div class="d-grid gap-3">
                    {% for task in tasks %}
                         {% if task.task_category == 1 %}
                             <form id="p-{{ task.id}}" method="post" action="delete/{{ task.id }}">
                                {% csrf_token %}
                                <div style="display:flex;justify-content: space-between;flex-direction: row; margin-top: 10px}" class="custom-card d-flex align-items-center " id="{{task.id}}" draggable="true">
                                    <p class=" fw-bold fs-6 text-wrap" style="color: black;width: 18rem">{{ task.task_name }}</p>
                                    <div>
                                        <a><button class="btn btn-link px-2 me-0"  type="button" onclick="editTask({{ task.id }})"><i class="fa fa-edit fa-lg"></i></button></a>
                                        <a><button class="btn btn-link px-2 me-0" type="submit"><i class="fa fa-trash fa-lg"></i></button></a>
                                    </div>
                                </div>
                            </form>
                            <form id="q-{{ task.id}}" method="post" action="edittask/{{ task.id }}" style="display: none">
                                {% csrf_token %}
                                <div style="display:flex;justify-content: space-between;flex-direction: row;}" class="custom-card d-flex align-items-center " id="card-token">
                                    {% render_field form.task_name value=task.task_name class="fw-bold fs-6 text-wrap" style="color: black;width: 18rem" %}
                                    <div>
                                       <a><button class="btn btn-link px-2 me-0" type="submit" onclick="hideCard({{ task.id }}, 'save', this)">save</button></a>
                                        <button class="btn btn-link px-2 me-0" type="button" onclick="hideCard({{ task.id }}, 'close', this)"><i class="fa fa-remove"></i></button>
                                    </div>
                                </div>
                            </form>
                        {% endif %}
                    {% endfor %}
                </div>
               </div>
                <div style="display:flex;justify-content: space-between;flex-direction: row;}" class="d-flex align-items-center row" id="div_ctrl">
                    <form method="post" id="form" style="display:none;">
                    {% csrf_token%}
                        <div>
                             <label class="mt-2 text-black font-weight-normal" for="task_name">Enter Task: </label>
                            {% render_field form.task_name class="form-control" %}
                        </div>
                         <div>
                            <button type="submit" style="padding: 10px"  class="btn btn-primary align-text-bottom " onclick="showValue()">Add Task</button>
                            <button type="button" class="btn btn-link px-2 me-0" style="font-size: 16px" onclick="showValue1()"><i class="fa fa-close fa-lg"></i></button>
                         </div>
                    </form>
                </div>
                <div style="float: right">
                    <button style="border-radius: 50%;padding: 0;position: relative;}" class="btn btn-primary btn-floating" type="submit" id="btn" onclick="showDiv()"><i class="fa fa-plus"></i></button>
                </div>
             </div>
        </div>
    </div>
            <br>
     <div  class="col-sm-4">
        <div style="background-color: #e0e0e0" class="card"  id="card2">
            <div class="card-body div1" id="div2">
                <h4 class="card-title"><a class="font-weight-bold" style="font-size: 35px">To Do</a></h4>
               <div class="card-text">
                <div class="d-grid gap-3">
                    {% for task in tasks %}
                         {% if task.task_category == 2 %}
                             <form id="p-{{ task.id}}" method="post" action="delete/{{ task.id }}">
                                {% csrf_token %}
                                <div style="display:flex;justify-content: space-between;flex-direction: row;margin-top: 10px}" class="custom-card d-flex align-items-center " id="{{task.id}}" draggable="true">
                                    <p class=" fw-bold fs-6 text-wrap" style="color: black;width: 18rem">{{ task.task_name }}</p>
                                    <div>
                                        <a><button class="btn btn-link px-2 me-0"  type="button" onclick="editTask({{ task.id }})"><i class="fa fa-edit fa-lg"></i></button></a>
                                        <a><button class="btn btn-link px-2 me-0" type="submit"><i class="fa fa-trash fa-lg"></i></button></a>
                                    </div>
                                </div>
                            </form>
                            <form id="q-{{ task.id}}" method="post" action="edittask/{{ task.id }}" style="display: none">
                                {% csrf_token %}
                                <div style="display:flex;justify-content: space-between;flex-direction: row;}" class="custom-card d-flex align-items-center " id="card-token">
                                    {% render_field form.task_name value=task.task_name class="fw-bold fs-6 text-wrap" style="color: black;width: 18rem" %}
                                    <div>
                                       <a><button class="btn btn-link px-2 me-0" type="submit" onclick="hideCard({{ task.id }}, 'save', this)">save</button></a>
                                        <button class="btn btn-link px-2 me-0" type="button" onclick="hideCard({{ task.id }}, 'close', this)"><i class="fa fa-remove"></i></button>
                                    </div>
                                </div>
                            </form>
                        {% endif %}
                    {% endfor %}
                </div>
               </div>
             </div>
        </div>
    </div>
            <br>
     <div  class="col-sm-4">
        <div style="background-color: #e0e0e0" class="card"  id="card3">
            <div class="card-body div1" id="div3">
                <h4 class="card-title"><a class="font-weight-bold" style="font-size: 35px">Done</a></h4>
               <div class="card-text">
                <div class="d-grid gap-3">
                    {% for task in tasks %}
                         {% if task.task_category == 3 %}
                             <form id="p-{{ task.id}}" method="post" action="delete/{{ task.id }}">
                                {% csrf_token %}
                                <div style="display:flex;justify-content: space-between;flex-direction: row;margin-top: 10px}" class="custom-card d-flex align-items-center " id="{{task.id}}" draggable="true">
                                    <p class=" fw-bold fs-6 text-wrap" style="color: black;width: 18rem">{{ task.task_name }}</p>
                                    <div>
                                        <a><button class="btn btn-link px-2 me-0"  type="button" onclick="editTask({{ task.id }})"><i class="fa fa-edit fa-lg"></i></button></a>
                                        <a><button class="btn btn-link px-2 me-0" type="submit"><i class="fa fa-trash fa-lg"></i></button></a>
                                    </div>
                                </div>
                            </form>
                            <form id="q-{{ task.id}}" method="post" action="edittask/{{ task.id }}" style="display: none">
                                {% csrf_token %}
                                <div style="display:flex;justify-content: space-between;flex-direction: row;}" class="custom-card d-flex align-items-center " id="card-token">
                                    {% render_field form.task_name value=task.task_name class="fw-bold fs-6 text-wrap" style="color: black;width: 18rem" %}
                                    <div>
                                       <a><button class="btn btn-link px-2 me-0" type="submit" onclick="hideCard({{ task.id }}, 'save', this)">save</button></a>
                                        <button class="btn btn-link px-2 me-0" type="button" onclick="hideCard({{ task.id }}, 'close', this)"><i class="fa fa-remove"></i></button>
                                    </div>
                                </div>
                            </form>
                        {% endif %}
                    {% endfor %}
                </div>
               </div>
             </div>
        </div>
    </div>
</div>
{% endblock %}
 </body>
</html>