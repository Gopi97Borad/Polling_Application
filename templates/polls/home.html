{% load widget_tweaks %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- Bootstrap -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://mdbcdn.b-cdn.net/wp-content/themes/mdbootstrap4/docs-app/css/dist/mdb5/plugins/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.10.1/mdb.min.css" rel="stylesheet"/>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.10.1/mdb.min.js"></script>
  <!-- Material Design for Bootstrap -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.5.16/css/mdb.min.css" rel="stylesheet">


<style>

.custom-card {
        border: 0; !important;
    box-shadow: 0 10px 15px -3px rgb(0 0 0 / 7%), 0 4px 6px -2px rgb(0 0 0 / 5%);
    /* max-width: 22rem; */
    position: relative;
    display: flex;
    flex-direction: column;
    min-width: 0;
    word-wrap: break-word;
    background-color: #fff;
    background-clip: border-box;
    /* border: 1px solid rgba(0,0,0,.125); */
    /* border-radius: 0.5rem; */
    padding: 1.5rem;
}
</style>

<script>
var tsk_id
    var currentURL = window.location.href
    var xhr = new XMLHttpRequest();

function showDiv(){
  document.getElementById('form').style.display = "block";
  document.getElementById('btn').style.display = "none";
  //document.getElementById('btn1').style.display = "none";
}

function showValue() {
  var name = document.getElementById('name')?.value;
  document.getElementById('form').style.display = "none";
  document.getElementById('btn').style.display = "block";
}

function showValue1() {
  document.getElementById('form').style.display = "none";
  document.getElementById('btn').style.display = "block";
}

function allowDrop(ev) {
  ev.preventDefault();
}

function drag(ev) {
  ev.dataTransfer.setData("text", ev.target.id);
}

function drop(ev) {
  ev.preventDefault();
  var data = ev.dataTransfer.getData('text');
  var target = ev.currentTarget;
  while (" "+target.className+" ".indexOf(" dropzone ") == -1) target = target.parentNode;
  target.appendChild(document.getElementById(data));
  var parentId = target.parentNode.getAttribute("id");
  var category = parentId == "card1" ? 1 : parentId == "card2" ? 2 : 3;
    xhr.open("GET", currentURL + 'update/' + data + '/' + category, true);
    xhr.send();
}

function logout() {
    xhr.open("GET", currentURL + 'logout');
    xhr.send();
    //window.reload();
}

function fn_delete(id) {
    xhr.open("GET", currentURL + 'delete/' + id, true);
    xhr.send();
    window.location.reload();
}

window.addEventListener("load",function () {
	var elms = document.querySelectorAll(".div1");
	for (var i = 0; i < elms.length; i++) {
		var zielzone = elms[i];
		zielzone.addEventListener("drop",drop);
		zielzone.addEventListener("dragover",allowDrop);
	};

	elms = document.querySelectorAll("[draggable=true]")
	for (var i = 0; i < elms.length; i++) {
		var draggable = elms[i];
		draggable.addEventListener("dragstart",drag);
	};
});

function editTask(ev) {
     document.getElementById('q-'+ ev).style.display = "block";
     document.getElementById('p-'+ ev).style.display = "none";
}

function hideCard(ev, action, token) {
     document.getElementById('p-'+ ev).style.display = "block";
     document.getElementById('q-'+ ev).style.display = "none";
}
</script>
</head>

{% block main %}

<body>
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-primary">
  <div class="container-fluid">
      <form style="float: right">
         <button type="submit" onclick="logout()"><i class="fa fa-power-off"></i></button>
      </form>
  </div>
</nav>
<!-- Navbar -->

<div class="row">
    <div class="col-sm-4">
        <div class="card" id="card1">
            <div class="card-body div1" id="div1">
                <h4 class="card-title"><a>Doing</a></h4>
               <div class="card-text">
                <div class="list-group drop-true list-group list-group-flush">
                    {% for task in tasks %}
                         {% if task.task_category == 1 %}
                             <form id="p-{{ task.id}}" method="post" action="delete/{{ task.id }}">
                                {% csrf_token %}
                                <div id="{{task.id}}" draggable="true">
                                <p class="custom-card">{{ task.task_name }}</p>
                                <a><button  type="button" onclick="editTask({{ task.id }})"><i class="fa fa-edit"></i></button></a>
                                <a><button type="submit"><i class="fa fa-remove"></i></button></a>
                                </div>
                            </form>
                            <form id="q-{{ task.id}}" method="post" action="edittask/{{ task.id }}" style="display: none">
                                {% csrf_token %}
                                <div class="custom-card" id="card-token">
                                    {% render_field form.task_name value=task.task_name %}
                                    <a><button type="submit" onclick="hideCard({{ task.id }}, 'save', this)">save</button></a>
                                    <button type="button" onclick="hideCard({{ task.id }}, 'close', this)"><i class="fa fa-remove"></i></button>
                                </div>
                            </form>
                        {% endif %}
                    {% endfor %}
                </div>
               </div>
                <div id="div_ctrl">
                    <form method="post" id="form" style="display:none;">
                    {% csrf_token%}
                            <label class="mt-2 text-black font-weight-normal" for="task_name">Enter Task: </label><br>
                            {% render_field form.task_name class="form-control" %}
                            <br>
                            <button type="submit" onclick="showValue()">submit</button>
                            <button type="button" onclick="showValue1()"><i class="fa fa-close"></i></button>
                    </form>
                </div>
                <div style="float: right">
                    <button type="submit" id="btn" onclick="showDiv()"><i class="fa fa-plus"></i></button>
                </div>
             </div>
        </div>
    </div>
            <br>
    <div class="col-sm-4">
        <div class="card" id="card2">
            <div class="card-body div1" id="div2">
                  <h4 class="card-title"><a>To Do</a></h4>
                <div class="card-text">
                    <div class="list-group drop-true list-group list-group-flush">
                          {% for task in tasks %}
                         {% if task.task_category == 2 %}
                             <form id="p-{{ task.id}}" method="post" action="delete/{{ task.id }}">
                                {% csrf_token %}
                                <div id="{{task.id}}" draggable="true">
                                <p class="custom-card">{{ task.task_name }}</p>
                                <a><button  type="button" onclick="editTask({{ task.id }})"><i class="fa fa-edit"></i></button></a>
                                <a><button type="submit"><i class="fa fa-remove"></i></button></a>
                                </div>
                            </form>
                            <form id="q-{{ task.id}}" method="post" action="edittask/{{ task.id }}" style="display: none">
                                {% csrf_token %}
                                <div class="custom-card" id="card-token">
                                    {% render_field form.task_name value=task.task_name %}
                                    <a><button type="submit" onclick="hideCard({{ task.id }}, 'save', this)">save</button></a>
                                    <button type="button" onclick="hideCard({{ task.id }}, 'close', this)"><i class="fa fa-remove"></i></button>
                                </div>
                            </form>
                        {% endif %}
                    {% endfor %}
                    </div>
                </div>
            </div>
            </div>
        </div>
            <br>
    <div class="col-sm-4">
        <div class="card" id="card3">
            <div class="card-body div1" id="div3">
                  <h4 class="card-title"><a>Done{{ task_name }} </a></h4>
                <div class="card-text">
                    <div class="list-group drop-true list-group list-group-flush">
                         {% for task in tasks %}
                         {% if task.task_category == 3 %}
                             <form id="p-{{ task.id}}" method="post" action="delete/{{ task.id }}">
                                {% csrf_token %}
                                <div id="{{task.id}}" draggable="true">
                                <p class="custom-card">{{ task.task_name }}</p>
                                <a><button  type="button" onclick="editTask({{ task.id }})"><i class="fa fa-edit"></i></button></a>
                                <a><button type="submit"><i class="fa fa-remove"></i></button></a>
                                </div>
                            </form>
                            <form id="q-{{ task.id}}" method="post" action="edittask/{{ task.id }}" style="display: none">
                                {% csrf_token %}
                                <div class="custom-card" id="card-token">
                                    {% render_field form.task_name value=task.task_name %}
                                    <a><button type="submit" onclick="hideCard({{ task.id }}, 'save', this)">save</button></a>
                                    <button type="button" onclick="hideCard({{ task.id }}, 'close', this)"><i class="fa fa-remove"></i></button>
                                </div>
                            </form>
                        {% endif %}
                    {% endfor %}
                    </div>
                </div>
            </div>
            </div>
        </div>
</div>
{% endblock %}
 </body>
</html>